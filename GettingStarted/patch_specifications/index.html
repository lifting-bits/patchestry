
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/img/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Firmware Patch Specification - Patchestry</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#firmware-patch-specification" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Patchestry" class="md-header__button md-logo" aria-label="Patchestry" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Patchestry
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Firmware Patch Specification
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="pink"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/lifting-bits/patchestry" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Patchestry" class="md-nav__button md-logo" aria-label="Patchestry" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Patchestry
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lifting-bits/patchestry" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build & Run
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ghidra/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ghidra Integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to contribute
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Dialects
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Dialects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Dialects/Pcode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pcode
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    About
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../statement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matching-types" class="md-nav__link">
    <span class="md-ellipsis">
      Matching Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Matching Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#function-based-vs-operation-based-matching" class="md-nav__link">
    <span class="md-ellipsis">
      Function-Based vs Operation-Based Matching
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specification-format" class="md-nav__link">
    <span class="md-ellipsis">
      Specification Format
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contract-types" class="md-nav__link">
    <span class="md-ellipsis">
      Contract Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Contract Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#runtime-vs-static-contracts" class="md-nav__link">
    <span class="md-ellipsis">
      Runtime vs Static Contracts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#field-descriptions" class="md-nav__link">
    <span class="md-ellipsis">
      Field Descriptions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Field Descriptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#top-level-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Top-Level Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metadata-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Metadata Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#target-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Target Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#libraries-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Libraries Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#meta-patch-entry-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Meta-Patch Entry Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#meta-contract-entry-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Meta-Contract Entry Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patch-action-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Patch Action Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contract-action-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Contract Action Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#match-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Match Fields
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Match Fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operation-based-matching" class="md-nav__link">
    <span class="md-ellipsis">
      Operation-Based Matching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function-context-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Function Context Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#symbol-match-fields-operation-based-matching" class="md-nav__link">
    <span class="md-ellipsis">
      Symbol Match Fields (Operation-Based Matching)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operand-match-fields-operation-based-matching" class="md-nav__link">
    <span class="md-ellipsis">
      Operand Match Fields (Operation-Based Matching)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argument-match-fields-function-based-matching" class="md-nav__link">
    <span class="md-ellipsis">
      Argument Match Fields (Function-Based Matching)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variable-match-fields-function-based-matching" class="md-nav__link">
    <span class="md-ellipsis">
      Variable Match Fields (Function-Based Matching)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#action-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Action Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimization-flags" class="md-nav__link">
    <span class="md-ellipsis">
      Optimization Flags
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#argument-specification" class="md-nav__link">
    <span class="md-ellipsis">
      Argument Specification
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Argument Specification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#argument-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Argument Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argument-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Argument Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argument-source-types" class="md-nav__link">
    <span class="md-ellipsis">
      Argument Source Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#argument-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Argument Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Argument Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#function-call-arguments" class="md-nav__link">
    <span class="md-ellipsis">
      Function Call Arguments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operation-operands" class="md-nav__link">
    <span class="md-ellipsis">
      Operation Operands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-level-global-symbol" class="md-nav__link">
    <span class="md-ellipsis">
      Module-Level Global Symbol
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#return-value-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Return Value Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mixed-argument-types" class="md-nav__link">
    <span class="md-ellipsis">
      Mixed Argument Types
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-patch-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Complete Patch Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Patch Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-usb-security-monitoring-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Example 1: USB Security Monitoring Deployment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operation-based-matching-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Operation-Based Matching Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Operation-Based Matching Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-monitor-sensitive-load-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Example 1: Monitor Sensitive Load Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-match-store-operations-with-specific-operands" class="md-nav__link">
    <span class="md-ellipsis">
      Example 2: Match Store Operations with Specific Operands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern-matching" class="md-nav__link">
    <span class="md-ellipsis">
      Pattern Matching
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patch-modes" class="md-nav__link">
    <span class="md-ellipsis">
      Patch Modes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Patch Modes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#apply-before-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Apply Before Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apply-after-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Apply After Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replace-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Replace Mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apply-at-entrypoint-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Apply At Entrypoint Mode
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="firmware-patch-specification">Firmware Patch Specification</h1>
<p>This document outlines the specification for patching firmware binaries using a declarative YAML format. The specification applies patches at the MLIR (Multi-Level Intermediate Representation) level, specifically using Clang IR MLIR representation, allowing for architecture-independent binary modifications.</p>
<h2 id="overview">Overview</h2>
<p>The patch specification is designed to apply patches at specific points in the decompiled MLIR representation:
- Before or after function calls
- At specific operations like memory loads, stores, or other operations
- Replace entire functions or operations
- Based on variable matching and symbolization</p>
<p>By working at the MLIR level, patches can be written once and applied across multiple architectures, as the MLIR abstraction handles the architecture-specific details.</p>
<h2 id="matching-types">Matching Types</h2>
<p>Patchestry supports two types of matching:</p>
<ol>
<li><strong>Function-Based Matching</strong>: Matches and instruments entire function calls</li>
<li><strong>Operation-Based Matching</strong>: Matches and instruments specific MLIR operations within functions</li>
</ol>
<h3 id="function-based-vs-operation-based-matching">Function-Based vs Operation-Based Matching</h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Function-Based</th>
<th>Operation-Based</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Granularity</strong></td>
<td>Entire function calls</td>
<td>Individual operations (load, store, arithmetic, etc.)</td>
</tr>
<tr>
<td><strong>Match Criteria</strong></td>
<td>Function symbol, arguments</td>
<td>Operation type, function context, variables</td>
</tr>
<tr>
<td><strong>Use Cases</strong></td>
<td>API monitoring, function replacement</td>
<td>Memory access tracking, operation validation</td>
</tr>
<tr>
<td><strong>Required Fields</strong></td>
<td><code>match.name</code> + <code>match.kind</code></td>
<td><code>match.name</code> + <code>match.kind</code></td>
</tr>
<tr>
<td><strong>Context</strong></td>
<td>Caller context</td>
<td>Function containing the operation</td>
</tr>
</tbody>
</table>
<h2 id="specification-format">Specification Format</h2>
<p>The patch specification is a YAML file with the following structure:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patchestry.io/v1</span><span class="w">             </span><span class="c1"># API version</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nt">metadata</span><span class="p">:</span><span class="w">                                </span><span class="c1"># Deployment metadata</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;deployment-name&quot;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Deployment</span><span class="nv"> </span><span class="s">description&quot;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">  </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Author</span><span class="nv"> </span><span class="s">Name&quot;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">  </span><span class="nt">created</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;YYYY-MM-DD&quot;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">  </span><span class="nt">organization</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;organization-name&quot;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="nt">target</span><span class="p">:</span><span class="w">                                  </span><span class="c1"># Target binary configuration</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">  </span><span class="nt">binary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;target_binary.bin&quot;</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">  </span><span class="nt">arch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ARCHITECTURE:ENDIANNESS:BITWIDTH:VARIANT&quot;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="nt">libraries</span><span class="p">:</span><span class="w">                               </span><span class="c1"># External patch and contract libraries</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;path/to/library.yaml&quot;</span><span class="w">             </span><span class="c1"># Each file may contain patches, contracts, or both</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="nt">execution_order</span><span class="p">:</span><span class="w">                         </span><span class="c1"># Order of patch/contract execution</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;meta_patches::meta_patch_name&quot;</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;meta_contracts::meta_contract_name&quot;</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="nt">meta_patches</span><span class="p">:</span><span class="w">                            </span><span class="c1"># Meta-patch configurations</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="w">    </span><span class="nt">optimization</span><span class="p">:</span><span class="w">                        </span><span class="c1"># Optimization settings</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;inline-patches&quot;</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;inline-contracts&quot;</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="w">    </span><span class="nt">patch_actions</span><span class="p">:</span><span class="w">                       </span><span class="c1"># Individual patch actions</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;PATCH-001&quot;</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="w">        </span><span class="nt">match</span><span class="p">:</span><span class="w">                           </span><span class="c1"># Match criteria</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="w">            </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="w">            </span><span class="c1"># Additional match criteria...</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="w">        </span><span class="nt">action</span><span class="p">:</span><span class="w">                          </span><span class="c1"># Patch actions</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="w">            </span><span class="nt">patch_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="w">            </span><span class="nt">arguments</span><span class="p">:</span><span class="w">                   </span><span class="c1"># Patch arguments</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="w">                </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="w">                </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0&quot;</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="w">                </span><span class="nt">is_reference</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="nt">meta_contracts</span><span class="p">:</span><span class="w">                          </span><span class="c1"># Meta-contract configurations</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="w">    </span><span class="nt">contract_actions</span><span class="p">:</span><span class="w">                    </span><span class="c1"># Individual contract actions</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CONTRACT-001&quot;</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a><span class="w">        </span><span class="nt">match</span><span class="p">:</span><span class="w">                          </span><span class="c1"># Contract match criteria</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="w">            </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="w">          </span><span class="c1"># Additional match criteria...</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="w">        </span><span class="nt">action</span><span class="p">:</span><span class="w">                         </span><span class="c1"># Contract actions</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a><span class="w">            </span><span class="nt">contract_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="w">            </span><span class="nt">arguments</span><span class="p">:</span><span class="w">                  </span><span class="c1"># Contract arguments</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="w">                </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;...&quot;</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="w">                </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span></code></pre></div>
<h2 id="contract-types">Contract Types</h2>
<p>Patchestry supports two types of contracts:</p>
<ol>
<li><strong>Runtime Contracts</strong>: Implemented as C/C++ functions that are called at runtime to validate conditions</li>
<li><strong>Static Contracts</strong>: Declarative specifications attached as MLIR attributes for static analysis and verification</li>
</ol>
<h3 id="runtime-vs-static-contracts">Runtime vs Static Contracts</h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Runtime Contracts</th>
<th>Static Contracts</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Implementation</strong></td>
<td>C/C++ function code</td>
<td>Declarative predicates in YAML</td>
</tr>
<tr>
<td><strong>Verification</strong></td>
<td>Runtime checks during execution</td>
<td>Static analysis at compile time</td>
</tr>
<tr>
<td><strong>Performance</strong></td>
<td>Runtime overhead</td>
<td>No runtime overhead</td>
</tr>
<tr>
<td><strong>Expressiveness</strong></td>
<td>Full programming language</td>
<td>Limited to supported predicates</td>
</tr>
<tr>
<td><strong>Use Cases</strong></td>
<td>Complex validations, security checks</td>
<td>null checks, range checks, type constraints</td>
</tr>
</tbody>
</table>
<h2 id="field-descriptions">Field Descriptions</h2>
<h3 id="top-level-fields">Top-Level Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>apiVersion</code></td>
<td>API version for the patch specification</td>
<td><code>"patchestry.io/v1"</code></td>
</tr>
<tr>
<td><code>metadata</code></td>
<td>Deployment metadata container</td>
<td>See metadata fields below</td>
</tr>
<tr>
<td><code>target</code></td>
<td>Target binary configuration</td>
<td>See target fields below</td>
</tr>
<tr>
<td><code>libraries</code></td>
<td>External patch and contract library references</td>
<td>See library fields below</td>
</tr>
<tr>
<td><code>execution_order</code></td>
<td>Order of patch/contract group execution</td>
<td><code>- "meta_patches::group_name"</code></td>
</tr>
<tr>
<td><code>meta_patches</code></td>
<td>Meta-patch group configurations</td>
<td>List of patch groups</td>
</tr>
<tr>
<td><code>meta_contracts</code></td>
<td>Meta-contract group configurations</td>
<td>List of contract groups</td>
</tr>
</tbody>
</table>
<h3 id="metadata-fields">Metadata Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>Deployment name identifier</td>
<td><code>"usb-security-monitoring"</code></td>
</tr>
<tr>
<td><code>description</code></td>
<td>Deployment description</td>
<td><code>"Deploy USB security monitoring"</code></td>
</tr>
<tr>
<td><code>version</code></td>
<td>Deployment version</td>
<td><code>"1.0.0"</code></td>
</tr>
<tr>
<td><code>author</code></td>
<td>Author or team name</td>
<td><code>"Security Team"</code></td>
</tr>
<tr>
<td><code>created</code></td>
<td>Creation date</td>
<td><code>"2025-01-15"</code></td>
</tr>
</tbody>
</table>
<h3 id="target-fields">Target Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>binary</code></td>
<td>Target binary file name</td>
<td><code>"firmware.bin"</code></td>
</tr>
<tr>
<td><code>arch</code></td>
<td>Target architecture specification in format "ARCH:ENDIANNESS:BITWIDTH"</td>
<td><code>"ARM:LE:32"</code></td>
</tr>
</tbody>
</table>
<h3 id="libraries-fields">Libraries Fields</h3>
<p><code>libraries</code> is a list of paths to external library YAML files. Each library file may define <code>patches</code>, <code>contracts</code>, or both. Paths are resolved relative to the location of the top-level spec file.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nt">libraries</span><span class="p">:</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;patches/my_patches.yaml&quot;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;patches/my_contracts.yaml&quot;</span><span class="w">   </span><span class="c1"># can also hold contracts despite the name</span>
</span></code></pre></div>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>libraries</code> (list entry)</td>
<td>Path to a library YAML file containing <code>patches:</code> and/or <code>contracts:</code> definitions</td>
<td><code>"patches/usb_security_patches.yaml"</code></td>
</tr>
</tbody>
</table>
<h3 id="meta-patch-entry-fields">Meta-Patch Entry Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>Unique identifier for the patch group</td>
<td><code>"usb_security_patches"</code></td>
</tr>
<tr>
<td><code>description</code></td>
<td>Description of the patch group purpose</td>
<td><code>"USB security monitoring patches"</code></td>
</tr>
<tr>
<td><code>optimization</code></td>
<td>List of optimization flags</td>
<td><code>["inline-patches", "inline-contracts"]</code></td>
</tr>
<tr>
<td><code>patch_actions</code></td>
<td>List of individual patch actions</td>
<td>See <a href="#patch-action-fields">patch action fields</a> below</td>
</tr>
</tbody>
</table>
<h3 id="meta-contract-entry-fields">Meta-Contract Entry Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>Unique identifier for the contract group</td>
<td><code>"usb_control_flow_contracts"</code></td>
</tr>
<tr>
<td><code>description</code></td>
<td>Description of the contract group purpose</td>
<td><code>"USB control flow integrity contracts"</code></td>
</tr>
<tr>
<td><code>contract_actions</code></td>
<td>List of individual contract actions</td>
<td>See <a href="#contract-action-fields">contract action fields</a> below</td>
</tr>
</tbody>
</table>
<h3 id="patch-action-fields">Patch Action Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>Unique identifier for the patch action</td>
<td><code>"USB-PATCH-001"</code></td>
</tr>
<tr>
<td><code>description</code></td>
<td>Description of what the patch does</td>
<td><code>"Add USB security validation"</code></td>
</tr>
<tr>
<td><code>match</code></td>
<td>List of match criteria</td>
<td>See <a href="#match-fields">match fields</a> below</td>
</tr>
<tr>
<td><code>action</code></td>
<td>List of actions to apply</td>
<td>See <a href="#action-fields">action fields</a> below</td>
</tr>
</tbody>
</table>
<h3 id="contract-action-fields">Contract Action Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>Unique identifier for the contract action</td>
<td><code>"USB-CONTRACT-001"</code></td>
</tr>
<tr>
<td><code>description</code></td>
<td>Description of what the contract does</td>
<td><code>"Add USB control flow integrity checking"</code></td>
</tr>
<tr>
<td><code>match</code></td>
<td>List of match criteria</td>
<td>See <a href="#match-fields">match fields</a> below</td>
</tr>
<tr>
<td><code>action</code></td>
<td>List of actions to apply</td>
<td>See <a href="#action-fields">action fields</a> below</td>
</tr>
</tbody>
</table>
<h3 id="match-fields">Match Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>match.name</code></td>
<td>Name pattern to match  a function name for <code>kind: "function"</code>, or an MLIR operation name (e.g. <code>"cir.call"</code>) for <code>kind: "operation"</code></td>
<td><code>"usbd_ep_write_packet"</code>, <code>"cir.call"</code></td>
</tr>
<tr>
<td><code>match.kind</code></td>
<td>Type of match target (<code>function</code> or <code>operation</code>)</td>
<td><code>"function"</code></td>
</tr>
<tr>
<td><code>match.function_context</code></td>
<td>Functions where matches should be applied</td>
<td><code>name: "/.*secure.*/"</code></td>
</tr>
<tr>
<td><code>match.variable_matches</code></td>
<td>Variables used in the operation (for function-based matching)</td>
<td><code>name: "/.*password.*/"</code></td>
</tr>
<tr>
<td><code>match.argument_matches</code></td>
<td>Function arguments to match (for function-based matching)</td>
<td>See below</td>
</tr>
<tr>
<td><code>match.symbol_matches</code></td>
<td>Symbols accessed by the operation (for operation-based matching)</td>
<td><code>name: "/.*password.*/"</code></td>
</tr>
<tr>
<td><code>match.operand_matches</code></td>
<td>Operands to match (for operation-based matching)</td>
<td>See below</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Multiple match entries</strong>: Currently, only the first entry under <code>match:</code> is evaluated by the implementation. If multiple entries are provided, <strong>only the first one is used</strong> and any additional entries are ignored.</p>
</blockquote>
<h4 id="operation-based-matching">Operation-Based Matching</h4>
<p>Operation-based matching is supported only for patches, meaning it is not supported for contract matching and insertion. For operation-based matching, set <code>kind: "operation"</code> and use <code>name</code> to specify the MLIR operation name to match. The following additional fields are available:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>match.name</code></td>
<td><strong>Required</strong> - MLIR operation name to match</td>
<td><code>"cir.load"</code>, <code>"cir.store"</code>, <code>"cir.call"</code></td>
</tr>
<tr>
<td><code>match.kind</code></td>
<td><strong>Required</strong> - must be <code>"operation"</code></td>
<td><code>"operation"</code></td>
</tr>
<tr>
<td><code>match.function_context</code></td>
<td>List of functions where operation should be matched</td>
<td><code>[{name: "/.*secure.*/"}]</code></td>
</tr>
<tr>
<td><code>match.symbol_matches</code></td>
<td>Symbols accessed by the operation</td>
<td><code>[{name: "/.*secret.*/", type: "!cir.ptr&lt;...&gt;"}]</code></td>
</tr>
<tr>
<td><code>match.operand_matches</code></td>
<td>Operands to match</td>
<td><code>[{index: 0, name: "addr", type: "!cir.ptr&lt;...&gt;"}]</code></td>
</tr>
</tbody>
</table>
<h4 id="function-context-fields">Function Context Fields</h4>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>Function name pattern (supports regex with <code>/pattern/</code>)</td>
<td><code>"/.*secure.*/</code>, <code>"authenticate"</code></td>
</tr>
</tbody>
</table>
<h4 id="symbol-match-fields-operation-based-matching">Symbol Match Fields  (Operation-Based Matching)</h4>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>Symbol name pattern (supports regex with <code>/pattern/</code>)</td>
<td><code>"/.*password.*/</code>, <code>"secret_key"</code></td>
</tr>
<tr>
<td><code>type</code></td>
<td>Symbol type pattern (optional)</td>
<td><code>"int32*"</code></td>
</tr>
</tbody>
</table>
<h4 id="operand-match-fields-operation-based-matching">Operand Match Fields (Operation-Based Matching)</h4>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>index</code></td>
<td>Position of the operand (0-based)</td>
<td><code>0</code> (first operand), <code>1</code> (second operand)</td>
</tr>
<tr>
<td><code>name</code></td>
<td>Name of the operand variable</td>
<td><code>"addr"</code>, <code>"/.*buffer.*/</code></td>
</tr>
<tr>
<td><code>type</code></td>
<td>Type of the operand</td>
<td><code>"int32*"</code></td>
</tr>
</tbody>
</table>
<p>Common operand patterns:
- <code>cir.load</code>: operand 0 = address to load from
- <code>cir.store</code>: operand 0 = value to store, operand 1 = address to store to
- <code>cir.binop</code>: operand 0 = left operand, operand 1 = right operand
- <code>cir.call</code>: operands = function arguments</p>
<h4 id="argument-match-fields-function-based-matching">Argument Match Fields (Function-Based Matching)</h4>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>index</code></td>
<td>Position of the argument (0-based)</td>
<td><code>1</code></td>
</tr>
<tr>
<td><code>name</code></td>
<td>Name of the argument</td>
<td><code>"buff"</code></td>
</tr>
<tr>
<td><code>type</code></td>
<td>Type of the argument</td>
<td><code>"void*"</code></td>
</tr>
</tbody>
</table>
<h4 id="variable-match-fields-function-based-matching">Variable Match Fields  (Function-Based Matching)</h4>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>Variable name pattern (supports regex with <code>/pattern/</code>)</td>
<td><code>"/.*password.*/</code>, <code>"secret_key"</code></td>
</tr>
<tr>
<td><code>type</code></td>
<td>Variable type pattern (optional)</td>
<td><code>"struct struct_anon_struct_4_1_58265f66*"</code></td>
</tr>
</tbody>
</table>
<h3 id="action-fields">Action Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>mode</code></td>
<td>Patching or contract mode to apply. Patch modes: <code>apply_before</code>, <code>apply_after</code>, <code>replace</code>. Contract-only mode: <code>apply_at_entrypoint</code></td>
<td><code>"apply_before"</code></td>
</tr>
<tr>
<td><code>patch_id</code></td>
<td>Reference to the patch implementation</td>
<td><code>"USB-PATCH-001"</code></td>
</tr>
<tr>
<td><code>description</code></td>
<td>Description of the action being applied</td>
<td><code>"Pre-validation security check"</code></td>
</tr>
<tr>
<td><code>arguments</code></td>
<td>List of arguments to pass to patch function</td>
<td>See <a href="#argument-specification">Argument Specification</a></td>
</tr>
</tbody>
</table>
<h3 id="optimization-flags">Optimization Flags</h3>
<p>The <code>optimization</code> field accepts a list of optimization settings:</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Applies to</th>
<th>Description</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>"inline-patches"</code></td>
<td><code>meta_patches</code></td>
<td>Inline patch function calls after insertion</td>
<td>Reduces function call overhead</td>
</tr>
<tr>
<td><code>"inline-contracts"</code></td>
<td><code>meta_contracts</code></td>
<td>Inline contract function calls after insertion</td>
<td>Reduces contract validation overhead</td>
</tr>
</tbody>
</table>
<h2 id="argument-specification">Argument Specification</h2>
<p>Arguments passed to patch or contract functions can come from different sources and are specified using a structured format that in general supports operands, function arguments, variables, and constants.</p>
<h3 id="argument-structure">Argument Structure</h3>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nt">arguments</span><span class="p">:</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;operand_value&quot;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;operand&quot;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;constant_size&quot;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;constant&quot;</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1024&quot;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;local_var&quot;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;variable&quot;</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="nt">symbol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;buffer_size&quot;</span>
</span></code></pre></div>
<h3 id="argument-fields">Argument Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Required</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>Descriptive name for the argument</td>
<td>Yes</td>
<td><code>"left_operand"</code>, <code>"store_address"</code></td>
</tr>
<tr>
<td><code>source</code></td>
<td>Where the argument comes from</td>
<td>Yes</td>
<td><code>"operand"</code>, <code>"argument"</code>, <code>"variable"</code>, <code>"symbol"</code>, <code>"constant"</code></td>
</tr>
<tr>
<td><code>index</code></td>
<td>Index for operands/arguments</td>
<td>When <code>source</code> is <code>"operand"</code> or <code>"argument"</code></td>
<td><code>0</code>, <code>1</code>, <code>2</code></td>
</tr>
<tr>
<td><code>symbol</code></td>
<td>Symbol name for local variables or module-level globals/functions</td>
<td>When <code>source</code> is <code>"variable"</code> or <code>"symbol"</code></td>
<td><code>"key_size"</code>, <code>"bl_spi_mode"</code></td>
</tr>
<tr>
<td><code>value</code></td>
<td>Literal value for constants</td>
<td>When <code>source</code> is <code>"constant"</code></td>
<td><code>"1024"</code>, <code>"0x1000"</code></td>
</tr>
<tr>
<td><code>is_reference</code></td>
<td>When <code>true</code>, passes a pointer to the value instead of the value itself, allowing the patch function to mutate the caller's variable. Supported for <code>operand</code>, <code>variable</code>, and <code>symbol</code> sources.</td>
<td>No (default: <code>false</code>)</td>
<td><code>true</code>, <code>false</code></td>
</tr>
</tbody>
</table>
<h3 id="argument-source-types">Argument Source Types</h3>
<table>
<thead>
<tr>
<th>Source</th>
<th>Description</th>
<th>Required Fields</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>operand</code> (alias: <code>argument</code>)</td>
<td>Operand or argument of the matched operation by zero-based index; <code>operand</code> and <code>argument</code> are interchangeable</td>
<td><code>index</code></td>
<td>Access operands/arguments of matched calls or operations</td>
</tr>
<tr>
<td><code>variable</code></td>
<td>Local variable in the enclosing function scope, located by its IR name attribute</td>
<td><code>symbol</code></td>
<td>Access local variables (alloca'd locals) in scope</td>
</tr>
<tr>
<td><code>symbol</code></td>
<td>Module-level global variable or function pointer, located in the module symbol table</td>
<td><code>symbol</code></td>
<td>Pass a global variable or function pointer to the patch</td>
</tr>
<tr>
<td><code>constant</code></td>
<td>Literal constant value</td>
<td><code>value</code></td>
<td>Pass fixed values to patch functions</td>
</tr>
<tr>
<td><code>return_value</code></td>
<td>Return value of function or operation</td>
<td>None</td>
<td>Access return value (<code>apply_before</code> / <code>apply_after</code> modes only  <strong>not valid for <code>apply_at_entrypoint</code></strong>)</td>
</tr>
</tbody>
</table>
<h3 id="argument-examples">Argument Examples</h3>
<h4 id="function-call-arguments">Function Call Arguments</h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># Validate function arguments before call</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nt">arguments</span><span class="p">:</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dest_ptr&quot;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;argument&quot;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;src_ptr&quot;</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;argument&quot;</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;max_size&quot;</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;constant&quot;</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4096&quot;</span>
</span></code></pre></div>
<h4 id="operation-operands">Operation Operands</h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Check arithmetic overflow</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nt">arguments</span><span class="p">:</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;left_val&quot;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;operand&quot;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;right_val&quot;</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;operand&quot;</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;overflow_limit&quot;</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;constant&quot;</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4294967295&quot;</span>
</span></code></pre></div>
<h4 id="module-level-global-symbol">Module-Level Global Symbol</h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># Pass a module-level global variable to the patch function</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="c1"># source: &quot;symbol&quot; looks up the name in the module symbol table (cir.GlobalOp or cir.FuncOp)</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="c1"># Use this for globals and function pointers; use source: &quot;variable&quot; for local alloca&#39;d variables</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="nt">arguments</span><span class="p">:</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;global_var&quot;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;symbol&quot;</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="nt">symbol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bl_spi_mode&quot;</span>
</span></code></pre></div>
<h4 id="return-value-handling">Return Value Handling</h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># Access function return value (apply_before / apply_after mode only)</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="c1"># NOTE: return_value is NOT valid for apply_at_entrypoint  the call</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="c1"># result is only defined at the matched call site, not at the function</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="c1"># entrypoint.  Use variable, symbol, or constant instead.</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="nt">arguments</span><span class="p">:</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;result&quot;</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;return_value&quot;</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;success_code&quot;</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;constant&quot;</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0&quot;</span>
</span></code></pre></div>
<h4 id="mixed-argument-types">Mixed Argument Types</h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># Comprehensive validation</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nt">arguments</span><span class="p">:</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;memory_addr&quot;</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;operand&quot;</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;buffer_size&quot;</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;variable&quot;</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">    </span><span class="nt">symbol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;allocated_size&quot;</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;validation_level&quot;</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;constant&quot;</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2&quot;</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;caller_func&quot;</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">    </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;argument&quot;</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">    </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span></code></pre></div>
<h2 id="complete-patch-examples">Complete Patch Examples</h2>
<h3 id="example-1-usb-security-monitoring-deployment">Example 1: USB Security Monitoring Deployment</h3>
<p>While patches and contracts don't need to be used together, they can; here is an example involving both. Based on the actual specification from <code>bl_usb__send_message_before_patch.yaml</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patchestry.io/v1</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;usb-security-monitoring-deployment&quot;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Deploy</span><span class="nv"> </span><span class="s">USB</span><span class="nv"> </span><span class="s">security</span><span class="nv"> </span><span class="s">monitoring</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">medical</span><span class="nv"> </span><span class="s">device</span><span class="nv"> </span><span class="s">firmware&quot;</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">  </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Security</span><span class="nv"> </span><span class="s">Team&quot;</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">  </span><span class="nt">created</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-01-15&quot;</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="nt">target</span><span class="p">:</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">  </span><span class="nt">binary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;medical_device_firmware.bin&quot;</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">  </span><span class="nt">arch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ARM:LE:32&quot;</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="nt">libraries</span><span class="p">:</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;patches/usb_security_patches.yaml&quot;</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="nt">execution_order</span><span class="p">:</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;meta_patches::usb_security_meta_patches&quot;</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;meta_contracts::usb_security_meta_contracts&quot;</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="nt">meta_patches</span><span class="p">:</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">usb_security_meta_patches</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Meta</span><span class="nv"> </span><span class="s">patches</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">USB</span><span class="nv"> </span><span class="s">security&quot;</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w">    </span><span class="nt">optimization</span><span class="p">:</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;inline-patches&quot;</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;inline-contracts&quot;</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w">    </span><span class="nt">patch_actions</span><span class="p">:</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;USB-PATCH-001&quot;</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Patch</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">add</span><span class="nv"> </span><span class="s">USB</span><span class="nv"> </span><span class="s">security</span><span class="nv"> </span><span class="s">validation&quot;</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">        </span><span class="nt">match</span><span class="p">:</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;usbd_ep_write_packet&quot;</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w">            </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;function&quot;</span>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w">            </span><span class="nt">function_context</span><span class="p">:</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bl_usb__send_message&quot;</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w">            </span><span class="nt">argument_matches</span><span class="p">:</span>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;usb_g&quot;</span>
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w">                </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;struct</span><span class="nv"> </span><span class="s">struct_anon_struct_4_1_58265f66*&quot;</span>
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="w">        </span><span class="nt">action</span><span class="p">:</span>
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;replace&quot;</span>
</span><span id="__span-8-43"><a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a><span class="w">            </span><span class="nt">patch_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;USB-PATCH-001&quot;</span>
</span><span id="__span-8-44"><a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Pre-validation</span><span class="nv"> </span><span class="s">security</span><span class="nv"> </span><span class="s">patch&quot;</span>
</span><span id="__span-8-45"><a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a><span class="w">            </span><span class="nt">arguments</span><span class="p">:</span>
</span><span id="__span-8-46"><a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;operand_0&quot;</span>
</span><span id="__span-8-47"><a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a><span class="w">                </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;operand&quot;</span>
</span><span id="__span-8-48"><a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a><span class="w">                </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0&quot;</span>
</span><span id="__span-8-49"><a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;variable_2&quot;</span>
</span><span id="__span-8-50"><a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a><span class="w">                </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;variable&quot;</span>
</span><span id="__span-8-51"><a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a><span class="w">                </span><span class="nt">symbol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;var1&quot;</span>
</span><span id="__span-8-52"><a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a>
</span><span id="__span-8-53"><a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a><span class="nt">meta_contracts</span><span class="p">:</span>
</span><span id="__span-8-54"><a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">usb_security_meta_contracts</span>
</span><span id="__span-8-55"><a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Contracts</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">USB</span><span class="nv"> </span><span class="s">security</span><span class="nv"> </span><span class="s">validation&quot;</span>
</span><span id="__span-8-56"><a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a><span class="w">    </span><span class="nt">contract_actions</span><span class="p">:</span>
</span><span id="__span-8-57"><a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;USB-CONTRACTS&quot;</span>
</span><span id="__span-8-58"><a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Assert</span><span class="nv"> </span><span class="s">allocation</span><span class="nv"> </span><span class="s">size</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">suitable&quot;</span>
</span><span id="__span-8-59"><a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a><span class="w">        </span><span class="nt">match</span><span class="p">:</span>
</span><span id="__span-8-60"><a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;usbd_ep_write_packet&quot;</span>
</span><span id="__span-8-61"><a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a><span class="w">            </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;function&quot;</span>
</span><span id="__span-8-62"><a id="__codelineno-8-62" name="__codelineno-8-62" href="#__codelineno-8-62"></a><span class="w">            </span><span class="nt">function_context</span><span class="p">:</span>
</span><span id="__span-8-63"><a id="__codelineno-8-63" name="__codelineno-8-63" href="#__codelineno-8-63"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bl_usb__send_message&quot;</span>
</span><span id="__span-8-64"><a id="__codelineno-8-64" name="__codelineno-8-64" href="#__codelineno-8-64"></a><span class="w">        </span><span class="nt">action</span><span class="p">:</span>
</span><span id="__span-8-65"><a id="__codelineno-8-65" name="__codelineno-8-65" href="#__codelineno-8-65"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apply_before&quot;</span>
</span><span id="__span-8-66"><a id="__codelineno-8-66" name="__codelineno-8-66" href="#__codelineno-8-66"></a><span class="w">            </span><span class="nt">contract_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;USB-CONTRACT-001&quot;</span>
</span><span id="__span-8-67"><a id="__codelineno-8-67" name="__codelineno-8-67" href="#__codelineno-8-67"></a><span class="w">            </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Pre-validation</span><span class="nv"> </span><span class="s">security</span><span class="nv"> </span><span class="s">contract&quot;</span>
</span><span id="__span-8-68"><a id="__codelineno-8-68" name="__codelineno-8-68" href="#__codelineno-8-68"></a><span class="w">            </span><span class="nt">arguments</span><span class="p">:</span>
</span><span id="__span-8-69"><a id="__codelineno-8-69" name="__codelineno-8-69" href="#__codelineno-8-69"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;operand_0&quot;</span>
</span><span id="__span-8-70"><a id="__codelineno-8-70" name="__codelineno-8-70" href="#__codelineno-8-70"></a><span class="w">                </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;operand&quot;</span>
</span><span id="__span-8-71"><a id="__codelineno-8-71" name="__codelineno-8-71" href="#__codelineno-8-71"></a><span class="w">                </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0&quot;</span>
</span></code></pre></div>
<h2 id="operation-based-matching-examples">Operation-Based Matching Examples</h2>
<h3 id="example-1-monitor-sensitive-load-operations">Example 1: Monitor Sensitive Load Operations</h3>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sensitive_loads&quot;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="nt">match</span><span class="p">:</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cir.load&quot;</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;operation&quot;</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">      </span><span class="nt">function_context</span><span class="p">:</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/.*secure.*/&quot;</span><span class="w">  </span><span class="c1"># Functions containing &quot;secure&quot;</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;authenticate&quot;</span><span class="w">  </span><span class="c1"># Exact function name</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">      </span><span class="nt">symbol_matches</span><span class="p">:</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/.*password.*/&quot;</span><span class="w">  </span><span class="c1"># Variables containing &quot;password&quot;</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;int32*&quot;</span>
</span></code></pre></div>
<h3 id="example-2-match-store-operations-with-specific-operands">Example 2: Match Store Operations with Specific Operands</h3>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;validate_stores&quot;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="nt">match</span><span class="p">:</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cir.store&quot;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;operation&quot;</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">      </span><span class="nt">function_context</span><span class="p">:</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/.*critical.*/&quot;</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">      </span><span class="nt">operand_matches</span><span class="p">:</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w">  </span><span class="c1"># The value being stored (first operand)</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user_input&quot;</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;char*&quot;</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># The address being stored to (second operand)</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;buffer&quot;</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;char[256]&quot;</span>
</span></code></pre></div>
<h3 id="pattern-matching">Pattern Matching</h3>
<p>Both function context and variable names support regex patterns when enclosed in forward slashes:</p>
<ul>
<li><code>/pattern/</code> - Regex pattern matching</li>
<li><code>exact_name</code> - Exact string matching</li>
</ul>
<p>Examples:
- <code>/.*secure.*/</code> matches functions containing "secure" anywhere
- <code>/^test_.*/</code> matches functions starting with "test_"
- <code>authenticate</code> matches exactly "authenticate"</p>
<h2 id="patch-modes">Patch Modes</h2>
<p>The specification supports three patch modes and one contract-only mode:</p>
<ul>
<li><code>apply_before</code>: Apply patch or contract before the matched function or operation</li>
<li><code>apply_after</code>: Apply patch or contract after the matched function or operation completes</li>
<li><code>replace</code>: Completely replace the matched function call or operation (patches only)</li>
<li><code>apply_at_entrypoint</code>: Insert a contract at the entry point of the <strong>caller</strong> function (contracts only  see <a href="#apply-at-entrypoint-mode">Apply At Entrypoint Mode</a>)</li>
</ul>
<h3 id="apply-before-mode">Apply Before Mode</h3>
<p>In <code>apply_before</code> mode, the patch is applied before the matched function or operation executes.
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nt">action</span><span class="p">:</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apply_before&quot;</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="nt">patch_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SECURITY-001&quot;</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Pre-execution</span><span class="nv"> </span><span class="s">validation&quot;</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span><span class="nt">arguments</span><span class="p">:</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;input_param&quot;</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">        </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;operand&quot;</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">        </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0&quot;</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;max_size&quot;</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">        </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;constant&quot;</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4096&quot;</span>
</span></code></pre></div></p>
<h3 id="apply-after-mode">Apply After Mode</h3>
<p>In <code>apply_after</code> mode, the patch or contract is applied immediately after the matched function call or operation completes. For patches, this works with both function-based and operation-based matching; for contracts, <code>apply_after</code> is currently only supported with function-based (function call) matching.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nt">action</span><span class="p">:</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apply_after&quot;</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="nt">patch_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;LOGGING-001&quot;</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Post-execution</span><span class="nv"> </span><span class="s">logging&quot;</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">    </span><span class="nt">arguments</span><span class="p">:</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;return_value&quot;</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">        </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;return_value&quot;</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;execution_time&quot;</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">        </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;variable&quot;</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">        </span><span class="nt">symbol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;timer_end&quot;</span>
</span></code></pre></div>
<h3 id="replace-mode">Replace Mode</h3>
<p>In <code>replace</code> mode, the matched function call is completely replaced by the patch function. The original code is not executed. <strong>When used with operation-based matching, the target operation must be a <code>cir.call</code></strong>  attempting to replace other operation types (e.g., <code>cir.store</code>) will log an error and leave the operation unchanged.</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nt">action</span><span class="p">:</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;replace&quot;</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span><span class="nt">patch_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SECURE-REPLACEMENT-001&quot;</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Secure</span><span class="nv"> </span><span class="s">function</span><span class="nv"> </span><span class="s">replacement&quot;</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="nt">arguments</span><span class="p">:</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;original_arg1&quot;</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">        </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;operand&quot;</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">        </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0&quot;</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;original_arg2&quot;</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">        </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;operand&quot;</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">        </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
</span></code></pre></div>
<h3 id="apply-at-entrypoint-mode">Apply At Entrypoint Mode</h3>
<p><code>apply_at_entrypoint</code> is a <strong>contract-only</strong> mode that inserts the contract call at the beginning of the <strong>caller</strong> function  the function that <em>contains</em> the matched call  rather than at the matched call site itself.</p>
<blockquote>
<p><strong>Important</strong>: The name can be misleading. The contract is <strong>not</strong> inserted at the beginning of the matched function (the callee). It is inserted at the beginning of the <em>enclosing</em> function (the caller) that was specified in <code>function_context</code>. Insertion happens after all <code>cir.alloca</code> ops and parameter-initialization stores so that all of the caller's parameters are in scope.</p>
</blockquote>
<p><strong>When to use it</strong>: When you want to validate invariants at function entry using the caller's local parameters, before any call inside the function executes.</p>
<p><strong>How it works</strong> (example):
- <code>match.name</code> = <code>"usbd_ep_write_packet"</code>  the call to find inside the caller
- <code>match.function_context.name</code> = <code>"bl_usb__send_message"</code>  the caller whose entry point receives the contract
- The contract call is inserted at the start of <code>bl_usb__send_message</code>, not at the <code>usbd_ep_write_packet</code> call site
- Arguments (e.g., <code>source: "variable"</code>) are resolved from <code>bl_usb__send_message</code>'s local scope</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nt">contract_actions</span><span class="p">:</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ENTRY-CONTRACT-001&quot;</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Null-check</span><span class="nv"> </span><span class="s">message</span><span class="nv"> </span><span class="s">pointer</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">function</span><span class="nv"> </span><span class="s">entry&quot;</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">    </span><span class="nt">match</span><span class="p">:</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;usbd_ep_write_packet&quot;</span><span class="w">   </span><span class="c1"># call to find inside the caller</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">        </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;function&quot;</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">        </span><span class="nt">function_context</span><span class="p">:</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bl_usb__send_message&quot;</span><span class="w">  </span><span class="c1"># contract inserts HERE, at this function&#39;s entry</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">    </span><span class="nt">action</span><span class="p">:</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apply_at_entrypoint&quot;</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">        </span><span class="nt">contract_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;message_entry_check_contract&quot;</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Runtime</span><span class="nv"> </span><span class="s">null-check</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">message</span><span class="nv"> </span><span class="s">pointer</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">bl_usb__send_message</span><span class="nv"> </span><span class="s">entry&quot;</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w">        </span><span class="nt">arguments</span><span class="p">:</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">          </span><span class="c1"># source: variable  load a named local/parameter alloca at entry</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;msg&quot;</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">            </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;variable&quot;</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">            </span><span class="nt">symbol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;msg&quot;</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w">          </span><span class="c1"># source: operand  index 0 maps to the 0th argument of bl_usb__send_message,</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="w">          </span><span class="c1"># not the 0th operand of the usbd_ep_write_packet call</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;usb_handle&quot;</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="w">            </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;operand&quot;</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="w">            </span><span class="nt">index</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span></code></pre></div>
<blockquote>
<p><strong>Note</strong>: The contract is inserted at the beginning of the <strong>caller</strong> (<code>bl_usb__send_message</code>  the function containing the matched call), not at the beginning of the matched function itself (<code>usbd_ep_write_packet</code>).</p>
</blockquote>
<h1 id="contract-library-specification">Contract Library Specification</h1>
<p>Contract libraries are separate YAML files that define reusable contracts. They can be referenced by multiple deployment specifications.</p>
<h3 id="contract-library-structure">Contract Library Structure</h3>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patchestry.io/v1</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;contract-library-name&quot;</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Description</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">contract</span><span class="nv"> </span><span class="s">library&quot;</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">  </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Author</span><span class="nv"> </span><span class="s">Name&quot;</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">  </span><span class="nt">created</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;YYYY-MM-DD&quot;</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="nt">contracts</span><span class="p">:</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;contract_name&quot;</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Contract</span><span class="nv"> </span><span class="s">description&quot;</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">    </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;validation_category&quot;</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">    </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;critical|high|medium|low&quot;</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;STATIC|RUNTIME&quot;</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">    </span><span class="c1"># For STATIC contracts</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">    </span><span class="nt">preconditions</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">    </span><span class="nt">postconditions</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">]</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">    </span><span class="c1"># For RUNTIME contracts</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">    </span><span class="nt">function_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">    </span><span class="nt">code_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</span></code></pre></div>
<h3 id="contract-library-fields">Contract Library Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Required</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>apiVersion</code></td>
<td>API version</td>
<td>Yes</td>
<td><code>"patchestry.io/v1"</code></td>
</tr>
<tr>
<td><code>metadata</code></td>
<td>Library metadata</td>
<td>Yes</td>
<td>See metadata fields</td>
</tr>
<tr>
<td><code>contracts</code></td>
<td>List of contract specifications</td>
<td>Yes</td>
<td>See contract spec fields</td>
</tr>
</tbody>
</table>
<h3 id="contract-specification-fields">Contract Specification Fields</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Required</th>
<th>Type</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td>Contract identifier</td>
<td>Yes</td>
<td>All</td>
<td><code>"usb_validation_contract"</code></td>
</tr>
<tr>
<td><code>description</code></td>
<td>Contract description</td>
<td>No</td>
<td>All</td>
<td><code>"Validates USB parameters"</code></td>
</tr>
<tr>
<td><code>category</code></td>
<td>Contract category</td>
<td>No</td>
<td>All</td>
<td><code>"validation"</code>, <code>"security"</code></td>
</tr>
<tr>
<td><code>severity</code></td>
<td>Severity level</td>
<td>No</td>
<td>All</td>
<td><code>"critical"</code>, <code>"high"</code>, <code>"medium"</code>, <code>"low"</code></td>
</tr>
<tr>
<td><code>type</code></td>
<td>Contract type</td>
<td>Yes</td>
<td>All</td>
<td><code>"STATIC"</code> or <code>"RUNTIME"</code></td>
</tr>
<tr>
<td><code>preconditions</code></td>
<td>Static preconditions</td>
<td>STATIC only</td>
<td>STATIC</td>
<td>List of precondition specs</td>
</tr>
<tr>
<td><code>postconditions</code></td>
<td>Static postconditions</td>
<td>STATIC only</td>
<td>STATIC</td>
<td>List of postcondition specs</td>
</tr>
<tr>
<td><code>function_name</code></td>
<td>Runtime contract function name</td>
<td>RUNTIME only</td>
<td>RUNTIME</td>
<td>Implementation details</td>
</tr>
<tr>
<td><code>code_file</code></td>
<td>Runtime contract implementation file</td>
<td>RUNTIME only</td>
<td>RUNTIME</td>
<td>Implementation details</td>
</tr>
</tbody>
</table>
<h3 id="static-contract-predicates">Static Contract Predicates</h3>
<p>Static contracts use declarative predicates that are attached as MLIR attributes. Each predicate specifies a condition that must hold.</p>
<h4 id="predicate-structure">Predicate Structure</h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nt">preconditions</span><span class="p">:</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;precondition_1&quot;</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Description</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">precondition&quot;</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="nt">pred</span><span class="p">:</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nonnull|relation|alignment|expr|range&quot;</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">      </span><span class="c1"># Fields depend on kind - see &quot;Predicate Kind Requirements&quot; below</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">      </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;arg0|arg1|...|return_value|symbol&quot;</span><span class="w">  </span><span class="c1"># Required for: nonnull, relation, range</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">      </span><span class="nt">relation</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eq|neq|lt|lte|gt|gte|none&quot;</span><span class="w">        </span><span class="c1"># Required for: relation</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;constant_value&quot;</span><span class="w">                      </span><span class="c1"># Required for: relation</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">      </span><span class="nt">symbol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;symbol_name&quot;</span><span class="w">                        </span><span class="c1"># Optional: descriptive symbol name</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">      </span><span class="nt">align</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;alignment_bytes&quot;</span><span class="w">                     </span><span class="c1"># Required for: alignment</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;expression_string&quot;</span><span class="w">                    </span><span class="c1"># Required for: expr</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">      </span><span class="nt">range</span><span class="p">:</span><span class="w">                                       </span><span class="c1"># Required for: range</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w">        </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;min_value&quot;</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="w">        </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;max_value&quot;</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="nt">postconditions</span><span class="p">:</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;postcondition_1&quot;</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Description</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">postcondition&quot;</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="w">    </span><span class="nt">pred</span><span class="p">:</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="w">      </span><span class="c1"># Same structure as preconditions</span>
</span></code></pre></div>
<h4 id="static-contract-predicate-fields">Static Contract Predicate Fields</h4>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Required</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>Unique identifier for the condition</td>
<td>Yes</td>
<td><code>"precondition_1"</code></td>
</tr>
<tr>
<td><code>description</code></td>
<td>Human-readable description</td>
<td>No</td>
<td><code>"Ensure pointer is non-null"</code></td>
</tr>
<tr>
<td><code>pred</code></td>
<td>Predicate specification</td>
<td>Yes</td>
<td>See predicate fields below</td>
</tr>
</tbody>
</table>
<h4 id="predicate-fields">Predicate Fields</h4>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Required</th>
<th>Valid Values</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>kind</code></td>
<td>Type of predicate</td>
<td>Yes</td>
<td><code>nonnull</code>, <code>relation</code>, <code>alignment</code>, <code>expr</code>, <code>range</code></td>
<td><code>"relation"</code></td>
</tr>
<tr>
<td><code>target</code></td>
<td>What the predicate applies to</td>
<td><code>nonnull</code>, <code>relation</code>, <code>range</code></td>
<td><code>arg0</code>, <code>arg1</code>, ..., <code>return_value</code>, <code>symbol</code></td>
<td><code>"arg0"</code></td>
</tr>
<tr>
<td><code>relation</code></td>
<td>Comparison relation</td>
<td><code>relation</code> only</td>
<td><code>eq</code>, <code>neq</code>, <code>lt</code>, <code>lte</code>, <code>gt</code>, <code>gte</code>, <code>none</code></td>
<td><code>"neq"</code></td>
</tr>
<tr>
<td><code>value</code></td>
<td>Constant value for comparison</td>
<td><code>relation</code> only</td>
<td>String representation of value</td>
<td><code>"0"</code>, <code>"NULL"</code></td>
</tr>
<tr>
<td><code>symbol</code></td>
<td>Symbol name reference (descriptive)</td>
<td>If target is symbol</td>
<td>Symbol name</td>
<td><code>"usb_device"</code></td>
</tr>
<tr>
<td><code>align</code></td>
<td>Alignment requirement in bytes</td>
<td><code>alignment</code> only</td>
<td>String representation of bytes</td>
<td><code>"4"</code>, <code>"8"</code></td>
</tr>
<tr>
<td><code>expr</code></td>
<td>Expression string</td>
<td><code>expr</code> only</td>
<td>Expression string</td>
<td><code>"usb_device != NULL"</code></td>
</tr>
<tr>
<td><code>range</code></td>
<td>Range constraint</td>
<td><code>range</code> only</td>
<td>Range object</td>
<td>See range fields</td>
</tr>
</tbody>
</table>
<h4 id="range-fields">Range Fields</h4>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>min</code></td>
<td>Minimum value (inclusive)</td>
<td><code>"0"</code></td>
</tr>
<tr>
<td><code>max</code></td>
<td>Maximum value (inclusive)</td>
<td><code>"USB_MAX_PACKET_SIZE"</code></td>
</tr>
</tbody>
</table>
<h4 id="predicate-kinds-and-required-fields">Predicate Kinds and Required Fields</h4>
<p>Each predicate kind requires specific fields. <strong>Only include the fields listed for each kind</strong> to avoid parser errors:</p>
<table>
<thead>
<tr>
<th>Kind</th>
<th>Description</th>
<th>Required Fields</th>
<th>Optional Fields</th>
<th>Example Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>nonnull</code></td>
<td>Assert target is not null</td>
<td><code>kind</code>, <code>target</code></td>
<td><code>symbol</code></td>
<td>Null pointer guard</td>
</tr>
<tr>
<td><code>relation</code></td>
<td>Compare target against a value</td>
<td><code>kind</code>, <code>target</code> (arg, return_value, or symbol), <code>relation</code>, <code>value</code></td>
<td><code>symbol</code></td>
<td>Bounds checking, comparisons</td>
</tr>
<tr>
<td><code>alignment</code></td>
<td>Verify memory alignment</td>
<td><code>kind</code>, <code>target</code>, <code>align</code></td>
<td><code>symbol</code></td>
<td>Memory alignment requirements</td>
</tr>
<tr>
<td><code>expr</code></td>
<td>Free-form expression</td>
<td><code>kind</code>, <code>expr</code></td>
<td><code>target</code>, <code>symbol</code></td>
<td>Complex conditions</td>
</tr>
<tr>
<td><code>range</code></td>
<td>Verify value is within range</td>
<td><code>kind</code>, <code>target</code> (arg, return_value, or symbol), <code>range</code> (with <code>min</code> and <code>max</code>)</td>
<td><code>symbol</code></td>
<td>Input validation, bounds</td>
</tr>
</tbody>
</table>
<h4 id="quick-reference-field-requirements-by-predicate-kind">Quick Reference: Field Requirements by Predicate Kind</h4>
<table>
<thead>
<tr>
<th>Predicate Kind</th>
<th><code>kind</code></th>
<th><code>target</code></th>
<th><code>relation</code></th>
<th><code>value</code></th>
<th><code>align</code></th>
<th><code>expr</code></th>
<th><code>range</code></th>
<th><code>symbol</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>nonnull</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Optional</td>
</tr>
<tr>
<td><strong>relation</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Optional</td>
</tr>
<tr>
<td><strong>alignment</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Optional</td>
</tr>
<tr>
<td><strong>expr</strong></td>
<td></td>
<td>Optional</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>range</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Optional</td>
</tr>
</tbody>
</table>
<p><strong>Legend</strong>:  = Required,  = Not allowed/Not used, Optional = May be included</p>
<p><strong>Important Notes:</strong>
- <strong><code>nonnull</code></strong>: Only requires <code>target</code> (e.g., <code>arg0</code>). Asserts the target pointer is not null. No other fields are used.
- <strong><code>relation</code></strong>: Must specify <code>target</code>, <code>relation</code> operator, and <code>value</code> to compare against. Target can be an argument, return value, or symbol reference.
- <strong><code>alignment</code></strong>: Must specify <code>target</code> and <code>align</code> (alignment in bytes). Typically used with pointer arguments.
- <strong><code>expr</code></strong>: Only requires the <code>expr</code> field with a free-form expression string. Target and symbol are optional for context.
- <strong><code>range</code></strong>: Must specify <code>target</code> and a <code>range</code> object with both <code>min</code> and <code>max</code> values.
- <strong><code>symbol</code></strong>: This field is always optional and serves as a descriptive reference to document what variable or symbol the predicate refers to.</p>
<h4 id="target-specification">Target Specification</h4>
<p>The <code>target</code> field specifies what the predicate applies to:</p>
<ul>
<li><strong><code>arg0</code>, <code>arg1</code>, etc.</strong>: Function arguments (0-indexed)</li>
<li><strong><code>return_value</code></strong>: Return value of the function</li>
<li><strong><code>symbol</code></strong>: A named symbol (requires <code>symbol</code> field)</li>
</ul>
<h4 id="relation-types">Relation Types</h4>
<p>For <code>relation</code> kind predicates:</p>
<table>
<thead>
<tr>
<th>Relation</th>
<th>Operators</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>eq</code></td>
<td><code>==</code></td>
<td>Equal to</td>
</tr>
<tr>
<td><code>neq</code></td>
<td><code>!=</code></td>
<td>Not equal to</td>
</tr>
<tr>
<td><code>lt</code></td>
<td><code>&lt;</code></td>
<td>Less than</td>
</tr>
<tr>
<td><code>lte</code></td>
<td><code>&lt;=</code></td>
<td>Less than or equal to</td>
</tr>
<tr>
<td><code>gt</code></td>
<td><code>&gt;</code></td>
<td>Greater than</td>
</tr>
<tr>
<td><code>gte</code></td>
<td><code>&gt;=</code></td>
<td>Greater than or equal to</td>
</tr>
<tr>
<td><code>none</code></td>
<td>-</td>
<td>No relation (for existence checks)</td>
</tr>
</tbody>
</table>
<h3 id="static-contract-examples">Static Contract Examples</h3>
<h4 id="example-1-null-pointer-guard-nonnull">Example 1: Null Pointer Guard (nonnull)</h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nt">preconditions</span><span class="p">:</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ptr_nonnull&quot;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;First</span><span class="nv"> </span><span class="s">argument</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">null&quot;</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">    </span><span class="nt">pred</span><span class="p">:</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nonnull&quot;</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">      </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;arg0&quot;</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">      </span><span class="nt">symbol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dest&quot;</span><span class="w">  </span><span class="c1"># Optional: for documentation</span>
</span></code></pre></div>
<p><strong>Required fields for <code>nonnull</code></strong>: <code>kind</code>, <code>target</code></p>
<h4 id="example-2-range-validation-range">Example 2: Range Validation (range)</h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="nt">preconditions</span><span class="p">:</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;size_range&quot;</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Buffer</span><span class="nv"> </span><span class="s">size</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">within</span><span class="nv"> </span><span class="s">valid</span><span class="nv"> </span><span class="s">range&quot;</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">    </span><span class="nt">pred</span><span class="p">:</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;range&quot;</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">      </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;arg1&quot;</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">      </span><span class="nt">range</span><span class="p">:</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">        </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0&quot;</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">        </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;USB_MAX_PACKET_SIZE&quot;</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">      </span><span class="nt">symbol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;buffer_size&quot;</span><span class="w">  </span><span class="c1"># Optional: for documentation</span>
</span></code></pre></div>
<p><strong>Required fields for <code>range</code></strong>: <code>kind</code>, <code>target</code>, <code>range</code> (with <code>min</code> and <code>max</code>)</p>
<h4 id="example-3-comparison-relation-relation">Example 3: Comparison Relation (relation)</h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nt">preconditions</span><span class="p">:</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;size_positive&quot;</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Size</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">greater</span><span class="nv"> </span><span class="s">than</span><span class="nv"> </span><span class="s">zero&quot;</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="nt">pred</span><span class="p">:</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;relation&quot;</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">      </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;arg1&quot;</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">      </span><span class="nt">relation</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;gt&quot;</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0&quot;</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">      </span><span class="nt">symbol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;size&quot;</span><span class="w">  </span><span class="c1"># Optional: for documentation</span>
</span></code></pre></div>
<p><strong>Required fields for <code>relation</code></strong>: <code>kind</code>, <code>target</code>, <code>relation</code>, <code>value</code></p>
<h4 id="example-4-memory-alignment-alignment">Example 4: Memory Alignment (alignment)</h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nt">preconditions</span><span class="p">:</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;buffer_aligned&quot;</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Buffer</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">4-byte</span><span class="nv"> </span><span class="s">aligned&quot;</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">    </span><span class="nt">pred</span><span class="p">:</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;alignment&quot;</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">      </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;arg0&quot;</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">      </span><span class="nt">align</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4&quot;</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">      </span><span class="nt">symbol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;buffer&quot;</span><span class="w">  </span><span class="c1"># Optional: for documentation</span>
</span></code></pre></div>
<p><strong>Required fields for <code>alignment</code></strong>: <code>kind</code>, <code>target</code>, <code>align</code></p>
<h4 id="example-5-complex-expression-expr">Example 5: Complex Expression (expr)</h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nt">preconditions</span><span class="p">:</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;device_valid&quot;</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;USB</span><span class="nv"> </span><span class="s">device</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">configured</span><span class="nv"> </span><span class="s">state&quot;</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="nt">pred</span><span class="p">:</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;expr&quot;</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;usb_device-&gt;state</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">USB_STATE_CONFIGURED&quot;</span>
</span></code></pre></div>
<p><strong>Required fields for <code>expr</code></strong>: <code>kind</code>, <code>expr</code>
<strong>Optional fields</strong>: <code>target</code>, <code>symbol</code> (for documentation)</p>
<h4 id="example-6-return-value-check-relation">Example 6: Return Value Check (relation)</h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nt">postconditions</span><span class="p">:</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;success_return&quot;</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Function</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">return</span><span class="nv"> </span><span class="s">success</span><span class="nv"> </span><span class="s">code&quot;</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">    </span><span class="nt">pred</span><span class="p">:</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;relation&quot;</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">      </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;return_value&quot;</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">      </span><span class="nt">relation</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;eq&quot;</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0&quot;</span>
</span></code></pre></div>
<p><strong>Required fields for <code>relation</code> on return value</strong>: <code>kind</code>, <code>target</code> (set to <code>return_value</code>), <code>relation</code>, <code>value</code></p>
<h3 id="complete-static-contract-example">Complete Static Contract Example</h3>
<p>This example demonstrates all predicate kinds with correct field usage:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patchestry.io/v1</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;usb-security-contracts&quot;</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;USB</span><span class="nv"> </span><span class="s">security</span><span class="nv"> </span><span class="s">contracts</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">medical</span><span class="nv"> </span><span class="s">devices&quot;</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">  </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Security</span><span class="nv"> </span><span class="s">Team&quot;</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">  </span><span class="nt">created</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-01-15&quot;</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="nt">contracts</span><span class="p">:</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;usb_endpoint_write_validation&quot;</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Validate</span><span class="nv"> </span><span class="s">USB</span><span class="nv"> </span><span class="s">endpoint</span><span class="nv"> </span><span class="s">write</span><span class="nv"> </span><span class="s">parameters&quot;</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">    </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;write_validation&quot;</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;STATIC&quot;</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">    </span><span class="nt">preconditions</span><span class="p">:</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">      </span><span class="c1"># Example 1: range predicate</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;size_range&quot;</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Write</span><span class="nv"> </span><span class="s">size</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">within</span><span class="nv"> </span><span class="s">valid</span><span class="nv"> </span><span class="s">range&quot;</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="w">        </span><span class="nt">pred</span><span class="p">:</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;range&quot;</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="w">          </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;arg2&quot;</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="w">          </span><span class="nt">range</span><span class="p">:</span>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="w">            </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="w">            </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;USB_MAX_PACKET_SIZE&quot;</span>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a><span class="w">      </span><span class="c1"># Example 2: alignment predicate</span>
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;buffer_aligned&quot;</span>
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Buffer</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">properly</span><span class="nv"> </span><span class="s">aligned&quot;</span>
</span><span id="__span-23-30"><a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="w">        </span><span class="nt">pred</span><span class="p">:</span>
</span><span id="__span-23-31"><a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;alignment&quot;</span>
</span><span id="__span-23-32"><a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="w">          </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;arg1&quot;</span>
</span><span id="__span-23-33"><a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a><span class="w">          </span><span class="nt">align</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4&quot;</span>
</span><span id="__span-23-34"><a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>
</span><span id="__span-23-35"><a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a><span class="w">    </span><span class="nt">postconditions</span><span class="p">:</span>
</span><span id="__span-23-36"><a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a><span class="w">      </span><span class="c1"># Example 3: relation predicate on return value</span>
</span><span id="__span-23-37"><a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;return_success&quot;</span>
</span><span id="__span-23-38"><a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Function</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">return</span><span class="nv"> </span><span class="s">success</span><span class="nv"> </span><span class="s">or</span><span class="nv"> </span><span class="s">error</span><span class="nv"> </span><span class="s">code&quot;</span>
</span><span id="__span-23-39"><a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a><span class="w">        </span><span class="nt">pred</span><span class="p">:</span>
</span><span id="__span-23-40"><a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a><span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;relation&quot;</span>
</span><span id="__span-23-41"><a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a><span class="w">          </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;return_value&quot;</span>
</span><span id="__span-23-42"><a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a><span class="w">          </span><span class="nt">relation</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;gte&quot;</span>
</span><span id="__span-23-43"><a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;-1&quot;</span>
</span><span id="__span-23-44"><a id="__codelineno-23-44" name="__codelineno-23-44" href="#__codelineno-23-44"></a>
</span><span id="__span-23-45"><a id="__codelineno-23-45" name="__codelineno-23-45" href="#__codelineno-23-45"></a><span class="w">      </span><span class="c1"># Example 4: expr predicate</span>
</span><span id="__span-23-46"><a id="__codelineno-23-46" name="__codelineno-23-46" href="#__codelineno-23-46"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;state_valid&quot;</span>
</span><span id="__span-23-47"><a id="__codelineno-23-47" name="__codelineno-23-47" href="#__codelineno-23-47"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Device</span><span class="nv"> </span><span class="s">state</span><span class="nv"> </span><span class="s">must</span><span class="nv"> </span><span class="s">remain</span><span class="nv"> </span><span class="s">valid&quot;</span>
</span><span id="__span-23-48"><a id="__codelineno-23-48" name="__codelineno-23-48" href="#__codelineno-23-48"></a><span class="w">        </span><span class="nt">pred</span><span class="p">:</span>
</span><span id="__span-23-49"><a id="__codelineno-23-49" name="__codelineno-23-49" href="#__codelineno-23-49"></a><span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;expr&quot;</span>
</span><span id="__span-23-50"><a id="__codelineno-23-50" name="__codelineno-23-50" href="#__codelineno-23-50"></a><span class="w">          </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;usb_device-&gt;state</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">USB_STATE_ERROR&quot;</span>
</span><span id="__span-23-51"><a id="__codelineno-23-51" name="__codelineno-23-51" href="#__codelineno-23-51"></a><span class="w">          </span><span class="c1"># Note: target and symbol are optional for expr predicates</span>
</span></code></pre></div>
<p><strong>Summary of field usage by predicate kind:</strong>
- <strong>nonnull</strong>: <code>kind</code> + <code>target</code> (<code>arg&lt;N&gt;</code>, <code>return_value</code>, or <code>symbol</code>)
- <strong>relation</strong>: <code>kind</code> + <code>target</code> + <code>relation</code> + <code>value</code> (<code>arg&lt;N&gt;</code>, <code>return_value</code>, or <code>symbol</code>)
- <strong>alignment</strong>: <code>kind</code> + <code>target</code> + <code>align</code> (<code>arg&lt;N&gt;</code>, <code>return_value</code>, or <code>symbol</code>)
- <strong>expr</strong>: <code>kind</code> + <code>expr</code>
- <strong>range</strong>: <code>kind</code> + <code>target</code> + <code>range</code> (with <code>min</code>/<code>max</code>) (<code>arg&lt;N&gt;</code>, <code>return_value</code>, or <code>symbol</code>)</p>
<h3 id="runtime-contract-implementation">Runtime Contract Implementation</h3>
<p>For runtime contracts, specify the implementation details:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="nt">contracts</span><span class="p">:</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;usb_endpoint_write_contract&quot;</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Runtime</span><span class="nv"> </span><span class="s">validation</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">USB</span><span class="nv"> </span><span class="s">endpoint</span><span class="nv"> </span><span class="s">write&quot;</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;RUNTIME&quot;</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">    </span><span class="nt">code_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;contracts/usb_validation.c&quot;</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">    </span><span class="nt">function_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;contract::usb_endpoint_write_validation&quot;</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;usb_device&quot;</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;usb_device_t*&quot;</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;USB</span><span class="nv"> </span><span class="s">device</span><span class="nv"> </span><span class="s">context&quot;</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;buffer&quot;</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;const</span><span class="nv"> </span><span class="s">void*&quot;</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Data</span><span class="nv"> </span><span class="s">buffer&quot;</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;size&quot;</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;uint32_t&quot;</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Buffer</span><span class="nv"> </span><span class="s">size&quot;</span>
</span></code></pre></div>
<h2 id="deployment-architecture">Deployment Architecture</h2>
<p>The meta-patch architecture allows for:</p>
<ol>
<li><strong>Modular Organization</strong>: Group related patches into logical units</li>
<li><strong>External Libraries</strong>: Reference shared patch and contract libraries</li>
<li><strong>Execution Ordering</strong>: Control the order of patch application</li>
<li><strong>Optimization Control</strong>: Fine-tune performance characteristics</li>
<li><strong>Exclusion Patterns</strong>: Exclude specific functions from patching</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://slack.empirehacking.nyc/" target="_blank" rel="noopener" title="slack.empirehacking.nyc" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  
    
  



  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.path", "navigation.indexes", "search.suggest", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>