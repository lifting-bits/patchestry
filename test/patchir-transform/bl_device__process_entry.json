// RUN: bash %strip-json-comments %s > %t.json
// RUN: %patchir-decomp -input %t.json -emit-cir -output %t1 >> /dev/null 2>&1

// RUN: %patchir-transform %t1.cir --spec %S/device_process_entry.yaml -o %t2.cir
// RUN: %file-check -vv -check-prefix=CHECK %s --input-file %t2.cir
// CHECK: %{{[0-9]+}} = cir.call @patch__replace__sprintf(%{{[0-9]+}}, %{{[0-9]+}}, %{{[0-9]+}}, %{{[0-9]+}}) {patchestry_operation = "cir.call"} : (!cir.ptr<!s8i>, !u32i, !cir.ptr<!s8i>, !cir.ptr<!s8i>) -> !s32i


{"architecture":"ARM","id":"ARM:LE:32:v7","format":"Executable and Linking Format (ELF)","functions":{"ram:00022fe0":{"name":"bl_device__process_entry","is_intrinsic":false,"type":{"return_type":"2169afe1","is_variadic":false,"is_noreturn":false,"parameter_types":["2169b041","6dbe5e37","6fb50c0a"]},"basic_blocks":{"ram:00022fe0:0:basic":{"operations":{"ram:00022ff8:28:0":{"mnemonic":"COPY","type":"2c7b6d4","output":{"kind":"local","operation":"unique:000da103:3:0"},"inputs":[{"type":"2c7b6d4","kind":"global","global":"ram:0003e02c"}]},"ram:00023004:590:1":{"mnemonic":"ADDRESS_OF","type":"33085c3b","inputs":[{"type":"3e635f45","kind":"local","operation":"unique:000da104:4:0"}]},"ram:0002300c:57:7":{"mnemonic":"CALL","type":"55d79ccc","output":{"kind":"local","operation":"unique:000da105:5:0"},"has_return_value":true,"target":{"kind":"function","function":"ram:00022cd4","is_variadic":false,"is_noreturn":false},"inputs":[{"type":"2169b041","kind":"parameter","operation":"unique:000da100:0:0"},{"type":"33085c3b","kind":"temporary","operation":"ram:00023004:590:1"}]},"ram:00023018:72:8":{"mnemonic":"INT_EQUAL","type":"55cce7b8","inputs":[{"type":"55d79ccc","kind":"local","operation":"unique:000da105:5:0"},{"type":"55d79ccc","kind":"constant","value":1}]},"ram:0002301a:78:9":{"mnemonic":"CBRANCH","taken_block":"ram:00023020:1:basic","not_taken_block":"ram:0002301c:6:basic","condition":{"type":"55cce7b8","kind":"temporary","operation":"ram:00023018:72:8"}}},"ordered_operations":["ram:00022ff8:28:0","ram:00023004:590:1","ram:0002300c:57:7","ram:00023018:72:8","ram:0002301a:78:9"]},"ram:00023020:1:basic":{"operations":{"ram:00023020:591:0":{"mnemonic":"ADDRESS_OF","type":"3e635f45","inputs":[{"type":"9338d987:3691549898266692664","kind":"local","operation":"unique:000da106:6:0"}]},"ram:0002302c:588:1":{"mnemonic":"COPY","type":"3e635f45","inputs":[{"type":"3e635f45","kind":"string","string_value":"/dev/%s"}]},"ram:0002302c:153:6":{"mnemonic":"CALL","type":"2c7b6d4","output":{"kind":"local","operation":"unique:000da107:7:0"},"has_return_value":true,"target":{"kind":"function","function":"EXTERNAL:00000067","is_variadic":true,"is_noreturn":false},"inputs":[{"type":"3e635f45","kind":"temporary","operation":"ram:00023020:591:0"},{"type":"3e635f45","kind":"temporary","operation":"ram:0002302c:588:1"},{"type":"2169b041","kind":"parameter","operation":"unique:000da100:0:0"}]},"ram:00023034:161:7":{"mnemonic":"INT_SLESS","type":"55cce7b8","inputs":[{"type":"2c7b6d4","kind":"local","operation":"unique:000da107:7:0"},{"type":"2c7b6d4","kind":"constant","value":0}]},"ram:00023036:168:8":{"mnemonic":"CBRANCH","taken_block":"ram:00023038:5:basic","not_taken_block":"ram:00023056:2:basic","condition":{"type":"55cce7b8","kind":"temporary","operation":"ram:00023034:161:7"}}},"ordered_operations":["ram:00023020:591:0","ram:0002302c:588:1","ram:0002302c:153:6","ram:00023034:161:7","ram:00023036:168:8"]},"ram:00023056:2:basic":{"operations":{"ram:00023058:592:0":{"mnemonic":"ADDRESS_OF","type":"3e635f45","inputs":[{"type":"9338d987:3691549898266692664","kind":"local","operation":"unique:000da106:6:0"}]},"ram:00023060:213:6":{"mnemonic":"CALL","type":"56d5e94b","output":{"kind":"local","operation":"unique:000da108:8:0"},"has_return_value":true,"target":{"kind":"function","function":"ram:00022edc","is_variadic":false,"is_noreturn":false},"inputs":[{"type":"6dbe5e37","kind":"parameter","operation":"unique:000da101:1:0"},{"type":"6fb50c0a","kind":"parameter","operation":"unique:000da102:2:0"},{"type":"3e635f45","kind":"temporary","operation":"ram:00023058:592:0"},{"type":"3e635f45","kind":"local","operation":"unique:000da104:4:0"}]},"ram:00023066:217:7":{"mnemonic":"INT_XOR","type":"56d5e94b","inputs":[{"type":"56d5e94b","kind":"local","operation":"unique:000da108:8:0"},{"type":"56d5e94b","kind":"constant","value":1}]},"ram:0002306a:223:8":{"mnemonic":"INT_AND","type":"56d5e94b","inputs":[{"type":"56d5e94b","kind":"temporary","operation":"ram:00023066:217:7"},{"type":"56d5e94b","kind":"constant","value":255}]},"ram:0002306c:228:9":{"mnemonic":"INT_EQUAL","type":"55cce7b8","inputs":[{"type":"56d5e94b","kind":"temporary","operation":"ram:0002306a:223:8"},{"type":"56d5e94b","kind":"constant","value":0}]},"ram:0002306e:234:10":{"mnemonic":"CBRANCH","taken_block":"ram:0002307c:3:basic","not_taken_block":"ram:00023070:4:basic","condition":{"type":"55cce7b8","kind":"temporary","operation":"ram:0002306c:228:9"}}},"ordered_operations":["ram:00023058:592:0","ram:00023060:213:6","ram:00023066:217:7","ram:0002306a:223:8","ram:0002306c:228:9","ram:0002306e:234:10"]},"ram:0002307c:3:basic":{"operations":{"ram:00023080:254:4":{"mnemonic":"CALL","has_return_value":true,"target":{"kind":"function","function":"EXTERNAL:00000009","is_variadic":false,"is_noreturn":false},"inputs":[{"type":"3e635f45","kind":"local","operation":"unique:000da104:4:0"}]},"ram:00023084:560:5":{"mnemonic":"COPY","type":"2169afe1","output":{"kind":"local","operation":"unique:000da109:9:0"},"inputs":[{"type":"2169afe1","kind":"constant","value":1}]},"ram:0002307c:3:basic.exit":{"mnemonic":"BRANCH","target_block":"ram:00023086:7:basic"}},"ordered_operations":["ram:00023080:254:4","ram:00023084:560:5","ram:0002307c:3:basic.exit"]},"ram:00023070:4:basic":{"operations":{"ram:00023074:241:4":{"mnemonic":"CALL","has_return_value":true,"target":{"kind":"function","function":"EXTERNAL:00000009","is_variadic":false,"is_noreturn":false},"inputs":[{"type":"3e635f45","kind":"local","operation":"unique:000da104:4:0"}]},"ram:00023078:562:5":{"mnemonic":"COPY","type":"2169afe1","output":{"kind":"local","operation":"unique:000da109:9:0"},"inputs":[{"type":"2169afe1","kind":"constant","value":0}]},"ram:0002307a:247:6":{"mnemonic":"BRANCH","target_block":"ram:00023086:7:basic"}},"ordered_operations":["ram:00023074:241:4","ram:00023078:562:5","ram:0002307a:247:6"]},"ram:00023038:5:basic":{"operations":{"ram:00023046:589:0":{"mnemonic":"COPY","type":"3e635f45","inputs":[{"type":"3e635f45","kind":"string","string_value":"Error saving device path: %s\n"}]},"ram:00023046:183:6":{"mnemonic":"CALL","has_return_value":true,"target":{"kind":"function","function":"EXTERNAL:00000064","is_variadic":true,"is_noreturn":false},"inputs":[{"type":"d7edf8ba","kind":"global","global":"ram:0003e10c"},{"type":"3e635f45","kind":"temporary","operation":"ram:00023046:589:0"},{"type":"2169b041","kind":"parameter","operation":"unique:000da100:0:0"}]},"ram:0002304e:190:11":{"mnemonic":"CALL","has_return_value":true,"target":{"kind":"function","function":"EXTERNAL:00000009","is_variadic":false,"is_noreturn":false},"inputs":[{"type":"3e635f45","kind":"local","operation":"unique:000da104:4:0"}]},"ram:00023052:563:12":{"mnemonic":"COPY","type":"2169afe1","output":{"kind":"local","operation":"unique:000da109:9:0"},"inputs":[{"type":"2169afe1","kind":"constant","value":0}]},"ram:00023054:196:13":{"mnemonic":"BRANCH","target_block":"ram:00023086:7:basic"}},"ordered_operations":["ram:00023046:589:0","ram:00023046:183:6","ram:0002304e:190:11","ram:00023052:563:12","ram:00023054:196:13"]},"ram:0002301c:6:basic":{"operations":{"ram:0002301c:564:0":{"mnemonic":"COPY","type":"2169afe1","output":{"kind":"local","operation":"unique:000da109:9:0"},"inputs":[{"type":"2169afe1","kind":"constant","value":1}]},"ram:0002301e:84:1":{"mnemonic":"BRANCH","target_block":"ram:00023086:7:basic"}},"ordered_operations":["ram:0002301c:564:0","ram:0002301e:84:1"]},"ram:00023086:7:basic":{"operations":{"ram:00023092:97:5":{"mnemonic":"INT_NOTEQUAL","type":"55cce7b8","inputs":[{"type":"2c7b6d4","kind":"global","global":"ram:0003e02c"},{"type":"2c7b6d4","kind":"local","operation":"unique:000da103:3:0"}]},"ram:00023098:106:6":{"mnemonic":"CBRANCH","taken_block":"ram:0002309a:9:basic","not_taken_block":"ram:0002309e:8:basic","condition":{"type":"55cce7b8","kind":"temporary","operation":"ram:00023092:97:5"}}},"ordered_operations":["ram:00023092:97:5","ram:00023098:106:6"]},"ram:0002309e:8:basic":{"operations":{"ram:000230a4:286:0":{"mnemonic":"COPY","type":"2169afe1","inputs":[{"type":"2169afe1","kind":"local","operation":"unique:000da109:9:0"}]},"ram:000230a4:136:3":{"mnemonic":"RETURN","inputs":[{"type":"2169afe1","kind":"temporary","operation":"ram:000230a4:286:0"}]}},"ordered_operations":["ram:000230a4:286:0","ram:000230a4:136:3"]},"ram:0002309a:9:basic":{"operations":{"ram:0002309a:110:4":{"mnemonic":"CALL","has_return_value":true,"target":{"kind":"function","function":"EXTERNAL:00000043","is_variadic":false,"is_noreturn":true},"inputs":[]},"ram:0002309a:112:7":{"mnemonic":"RETURN","inputs":[]}},"ordered_operations":["ram:0002309a:110:4","ram:0002309a:112:7"]},"ram:00022fe0:entry":{"operations":{"unique:000da100:0:0":{"mnemonic":"DECLARE_PARAMETER","name":"param_1","type":"2169b041","kind":"parameter","index":0},"unique:000da101:1:0":{"mnemonic":"DECLARE_PARAMETER","name":"param_2","type":"6dbe5e37","kind":"parameter","index":1},"unique:000da102:2:0":{"mnemonic":"DECLARE_PARAMETER","name":"param_3","type":"6fb50c0a","kind":"parameter","index":2},"unique:000da103:3:0":{"mnemonic":"DECLARE_LOCAL","kind":"local","name":"local_14","type":"2c7b6d4"},"unique:000da104:4:0":{"mnemonic":"DECLARE_LOCAL","kind":"local","name":"local_3c","type":"3e635f45"},"unique:000da105:5:0":{"mnemonic":"DECLARE_LOCAL","kind":"local","name":"cVar1","type":"55d79ccc"},"unique:000da106:6:0":{"mnemonic":"DECLARE_LOCAL","kind":"local","name":"acStack_34","type":"9338d987:3691549898266692664"},"unique:000da107:7:0":{"mnemonic":"DECLARE_LOCAL","kind":"local","name":"local_38","type":"2c7b6d4"},"unique:000da108:8:0":{"mnemonic":"DECLARE_LOCAL","kind":"local","name":"uVar2","type":"56d5e94b"},"unique:000da109:9:0":{"mnemonic":"DECLARE_LOCAL","kind":"local","name":"uVar3","type":"2169afe1"},"entry.exit":{"mnemonic":"BRANCH","target_block":"ram:00022fe0:0:basic"}},"ordered_operations":["unique:000da100:0:0","unique:000da101:1:0","unique:000da102:2:0","unique:000da103:3:0","unique:000da104:4:0","unique:000da105:5:0","unique:000da106:6:0","unique:000da107:7:0","unique:000da108:8:0","unique:000da109:9:0","entry.exit"]}},"entry_block":"ram:00022fe0:entry"},"ram:00022cd4":{"name":"bl_device__match","is_intrinsic":false,"type":{"return_type":"2169afe1","is_variadic":false,"is_noreturn":false,"parameter_types":["2169b041","6dbe5e37"]}},"EXTERNAL:00000067":{"name":"sprintf","is_intrinsic":false,"type":{"return_type":"2c7b6d4","is_variadic":true,"is_noreturn":false,"parameter_types":["3e635f45","3e635f45"]}},"ram:00022edc":{"name":"bl_device__list_append","is_intrinsic":false,"type":{"return_type":"2169b041","is_variadic":false,"is_noreturn":false,"parameter_types":["6dbe5e37","6fb50c0a","3e635f45","3e635f45"]}},"EXTERNAL:00000009":{"name":"free","is_intrinsic":false,"type":{"return_type":"56e6a64d","is_variadic":false,"is_noreturn":false,"parameter_types":["37d61047"]}},"EXTERNAL:00000064":{"name":"fprintf","is_intrinsic":false,"type":{"return_type":"2c7b6d4","is_variadic":true,"is_noreturn":false,"parameter_types":["d7edf8ba","3e635f45"]}},"EXTERNAL:00000043":{"name":"__stack_chk_fail","is_intrinsic":false,"type":{"return_type":"56e6a64d","is_variadic":false,"is_noreturn":true,"parameter_types":[]}}},"globals":{"ram:0003e10c":{"name":"stderr","size":"4","type":"d7edf8ba"},"ram:0003e02c":{"name":"__stack_chk_guard","size":"4","type":"2c7b6d4"}},"types":{"2169afe1":{"name":"undefined1","size":1,"kind":"undefined"},"2169b041":{"name":"undefined4","size":4,"kind":"undefined"},"6dbe5e37":{"kind":"pointer","size":4,"element_type":"2169b041"},"6fb50c0a":{"kind":"pointer","size":4,"element_type":"2c7b6d4"},"2c7b6d4":{"name":"int","size":4,"kind":"integer"},"33085c3b":{"kind":"pointer","size":4,"element_type":"3e635f45"},"3e635f45":{"kind":"pointer","size":4,"element_type":"55d79ccc"},"55d79ccc":{"name":"char","size":1,"kind":"integer"},"55cce7b8":{"name":"bool","size":1,"kind":"boolean"},"9338d987:3691549898266692664":{"kind":"array","size":32,"num_elements":32,"element_type":"55d79ccc"},"56d5e94b":{"name":"unsigned int","size":4,"kind":"integer"},"d7edf8ba":{"kind":"pointer","size":4,"element_type":"d7ee39de:2585014296036210384"},"56e6a64d":{"name":"void","size":0,"kind":"void"},"37d61047":{"kind":"pointer","size":4,"element_type":"56e6a64d"},"d7ee39de:2585014296036210384":{"name":"FILE","kind":"typedef","size":152,"base_type":"aef5b364:2643428143008110649"},"aef5b364:2643428143008110649":{"name":"_IO_FILE","kind":"struct","size":152,"fields":[{"type":"2c7b6d4","offset":0,"name":"_flags"},{"type":"3e635f45","offset":4,"name":"_IO_read_ptr"},{"type":"3e635f45","offset":8,"name":"_IO_read_end"},{"type":"3e635f45","offset":12,"name":"_IO_read_base"},{"type":"3e635f45","offset":16,"name":"_IO_write_base"},{"type":"3e635f45","offset":20,"name":"_IO_write_ptr"},{"type":"3e635f45","offset":24,"name":"_IO_write_end"},{"type":"3e635f45","offset":28,"name":"_IO_buf_base"},{"type":"3e635f45","offset":32,"name":"_IO_buf_end"},{"type":"3e635f45","offset":36,"name":"_IO_save_base"},{"type":"3e635f45","offset":40,"name":"_IO_backup_base"},{"type":"3e635f45","offset":44,"name":"_IO_save_end"},{"type":"84f9ea20","offset":48,"name":"_markers"},{"type":"aef57240","offset":52,"name":"_chain"},{"type":"2c7b6d4","offset":56,"name":"_fileno"},{"type":"2c7b6d4","offset":60,"name":"_flags2"},{"type":"3a63bc14:2643428142712412213","offset":64,"name":"_old_offset"},{"type":"9bb5cdc","offset":68,"name":"_cur_column"},{"type":"55d79ccc","offset":70,"name":"_vtable_offset"},{"type":"8e237aaf","offset":71,"name":"_shortbuf"},{"type":"8534d23a","offset":72,"name":"_lock"},{"type":"2e06db5a:2643428142712412218","offset":80,"name":"_offset"},{"type":"37d61047","offset":88,"name":"__pad1"},{"type":"37d61047","offset":92,"name":"__pad2"},{"type":"37d61047","offset":96,"name":"__pad3"},{"type":"37d61047","offset":100,"name":"__pad4"},{"type":"b52ec333:3194934749518994060","offset":104,"name":"__pad5"},{"type":"2c7b6d4","offset":108,"name":"_mode"},{"type":"93460867","offset":112,"name":"_unused2"}]},"84f9ea20":{"kind":"pointer","size":4,"element_type":"886b2aab:2643428143373015091"},"aef57240":{"kind":"pointer","size":4,"element_type":"aef5b364:2643428143008110649"},"3a63bc14:2643428142712412213":{"name":"__off_t","kind":"typedef","size":4,"base_type":"5659ce69"},"9bb5cdc":{"name":"unsigned short","size":2,"kind":"integer"},"8e237aaf":{"kind":"array","size":1,"num_elements":1,"element_type":"55d79ccc"},"8534d23a":{"kind":"pointer","size":4,"element_type":"30e34900:2643428143373015088"},"2e06db5a:2643428142712412218":{"name":"__off64_t","kind":"typedef","size":8,"base_type":"e1d3b4f1"},"b52ec333:3194934749518994060":{"name":"size_t","kind":"typedef","size":4,"base_type":"8411ead2"},"93460867":{"kind":"array","size":40,"num_elements":40,"element_type":"55d79ccc"},"886b2aab:2643428143373015091":{"name":"_IO_marker","kind":"struct","size":12,"fields":[{"type":"84f9ea20","offset":0,"name":"_next"},{"type":"aef57240","offset":4,"name":"_sbuf"},{"type":"2c7b6d4","offset":8,"name":"_pos"}]},"5659ce69":{"name":"long","size":4,"kind":"integer"},"30e34900:2643428143373015088":{"name":"_IO_lock_t","kind":"typedef","size":0,"base_type":"56e6a64d"},"e1d3b4f1":{"name":"long long","size":8,"kind":"integer"},"8411ead2":{"name":"unsigned long","size":4,"kind":"integer"}}}